<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LG ThinQ Debug Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>LG ThinQ Debug Tool</h1>
        <nav class="nav-menu">
            <button class="nav-btn active" data-page="monitor">Monitor</button>
            <button class="nav-btn" data-page="appliances">Appliances</button>
            <button class="nav-btn" data-page="config">Configuration</button>
            <button class="nav-btn" data-page="tools">Tools</button>
        </nav>
        <div class="status-indicator">
            <span id="connection-status">Disconnected</span>
        </div>
    </header>

    <main>
        <!-- Monitor Page -->
        <div class="page active" id="monitor-page">
            <div class="dashboard">
                <!-- Protocol Monitor Panel -->
                <div class="panel">
                    <h2>Protocol Monitor</h2>
                    <div class="controls">
                        <button id="start-monitoring" class="btn btn-primary">Start Monitoring</button>
                        <button id="stop-monitoring" class="btn btn-secondary" disabled>Stop Monitoring</button>
                        <button id="clear-messages" class="btn btn-danger">Clear Messages</button>
                    </div>
                    <div class="filter-controls">
                        <label>
                            <input type="checkbox" id="filter-setup" checked> Setup Protocol
                        </label>
                        <label>
                            <input type="checkbox" id="filter-cloud" checked> Cloud Protocol
                        </label>
                        <label>
                            <input type="checkbox" id="filter-tlv" checked> TLV Messages
                        </label>
                    </div>
                </div>

                <!-- Message Feed -->
                <div class="panel message-feed">
                    <h2>Message Feed</h2>
                    <div id="message-container" class="message-container">
                        <div class="message info">
                            <span class="timestamp">Ready</span>
                            <span class="content">Protocol monitoring ready. Click "Start Monitoring" to begin.</span>
                        </div>
                    </div>
                </div>

                <!-- Device State Panel -->
                <div class="panel">
                    <h2>Device State</h2>
                    <div id="device-state" class="device-state">
                        <div class="state-item">
                            <span class="label">Connection:</span>
                            <span class="value" id="device-connection">Unknown</span>
                        </div>
                        <div class="state-item">
                            <span class="label">Setup Phase:</span>
                            <span class="value" id="setup-phase">None</span>
                        </div>
                        <div class="state-item">
                            <span class="label">Last Message:</span>
                            <span class="value" id="last-message">N/A</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Appliances Page -->
        <div class="page" id="appliances-page">
            <div class="dashboard">
                <!-- LG Cloud Server Control -->
                <div class="panel">
                    <h2>LG Local Cloud Server</h2>
                    <div class="controls">
                        <button id="start-lg-cloud" class="btn btn-primary">Start LG Cloud</button>
                        <button id="stop-lg-cloud" class="btn btn-secondary" disabled>Stop LG Cloud</button>
                        <span id="lg-cloud-status" class="status-text">Stopped</span>
                    </div>
                    <div class="server-info">
                        <p><strong>Purpose:</strong> Intercepts communication from configured appliances</p>
                        <p><strong>API Port:</strong> 8080 | <strong>MQTT Port:</strong> 1883</p>
                    </div>
                </div>

                <!-- Setup Server Control -->
                <div class="panel">
                    <h2>Setup Protocol Server</h2>
                    <div class="controls">
                        <button id="start-setup-server" class="btn btn-primary">Start Setup Server</button>
                        <button id="stop-setup-server" class="btn btn-secondary" disabled>Stop Setup Server</button>
                        <span id="setup-server-status" class="status-text">Stopped</span>
                    </div>
                    <div class="setup-config">
                        <h3>Wi-Fi Configuration</h3>
                        <div class="form-group">
                            <label for="wifi-ssid">SSID:</label>
                            <input type="text" id="wifi-ssid" placeholder="Enter Wi-Fi SSID">
                        </div>
                        <div class="form-group">
                            <label for="wifi-password">Password:</label>
                            <input type="password" id="wifi-password" placeholder="Enter Wi-Fi password">
                        </div>
                        <button id="save-wifi-config" class="btn btn-primary">Save Wi-Fi Config</button>
                    </div>
                    <div class="server-info">
                        <p><strong>Purpose:</strong> Configures new appliances during setup</p>
                        <p><strong>Port:</strong> 5500 (TLS)</p>
                    </div>
                </div>

                <!-- Connected Appliances -->
                <div class="panel">
                    <h2>Connected Appliances</h2>
                    <div id="connected-devices" class="device-list">
                        <div class="no-devices">No appliances connected</div>
                    </div>
                </div>

                <!-- Appliance Messages -->
                <div class="panel message-feed">
                    <h2>Appliance Messages</h2>
                    <div id="appliance-messages" class="message-container">
                        <div class="message info">
                            <span class="timestamp">Ready</span>
                            <span class="content">Start setup server to see appliance messages</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Page -->
        <div class="page" id="config-page">
            <div class="dashboard">
                <!-- MQTT Configuration -->
                <div class="panel">
                    <h2>MQTT Configuration</h2>
                    <div class="config-form">
                        <div class="form-group">
                            <label for="mqtt-url">MQTT URL:</label>
                            <input type="text" id="mqtt-url" placeholder="mqtt://localhost:1883">
                        </div>
                        <div class="form-group">
                            <label for="mqtt-username">Username:</label>
                            <input type="text" id="mqtt-username" placeholder="Optional">
                        </div>
                        <div class="form-group">
                            <label for="mqtt-password">Password:</label>
                            <input type="password" id="mqtt-password" placeholder="Optional">
                        </div>
                        <div class="form-group">
                            <label for="discovery-prefix">Discovery Prefix:</label>
                            <input type="text" id="discovery-prefix" placeholder="homeassistant">
                        </div>
                        <div class="form-group">
                            <label for="rethink-prefix">Rethink Prefix:</label>
                            <input type="text" id="rethink-prefix" placeholder="rethink">
                        </div>
                        <div class="controls">
                            <button id="save-mqtt-config" class="btn btn-primary">Save MQTT Config</button>
                            <button id="test-mqtt-connection" class="btn btn-secondary">Test Connection</button>
                        </div>
                    </div>
                </div>

                <!-- Server Configuration -->
                <div class="panel">
                    <h2>Server Configuration</h2>
                    <div class="config-form">
                        <div class="form-group">
                            <label for="server-port">Server Port:</label>
                            <input type="number" id="server-port" placeholder="3001">
                        </div>
                        <div class="form-group">
                            <label for="log-level">Log Level:</label>
                            <select id="log-level">
                                <option value="error">Error</option>
                                <option value="warn">Warning</option>
                                <option value="info">Info</option>
                                <option value="debug">Debug</option>
                            </select>
                        </div>
                        <button id="save-server-config" class="btn btn-primary">Save Server Config</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tools Page -->
        <div class="page" id="tools-page">
            <div class="dashboard">
                <!-- TLV Parser Panel -->
                <div class="panel">
                    <h2>TLV Parser</h2>
                    <div class="parser-controls">
                        <textarea id="tlv-input" placeholder="Enter hex data to parse (e.g., 0105hello0203hi)"></textarea>
                        <button id="parse-tlv" class="btn btn-primary">Parse TLV</button>
                    </div>
                    <div id="tlv-output" class="parser-output"></div>
                </div>

                <!-- JSON Parser Panel -->
                <div class="panel">
                    <h2>JSON Protocol Parser</h2>
                    <div class="parser-controls">
                        <textarea id="json-input" placeholder='Enter JSON message (e.g., {"type":"request","cmd":"getDeviceInfo","data":{}})'></textarea>
                        <button id="parse-json" class="btn btn-primary">Parse JSON</button>
                    </div>
                    <div id="json-output" class="parser-output"></div>
                </div>
            </div>
        </div>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script src="app.js"></script>
</body>
</html>